# 付箋→カード化の検討結果

## 結論
**現時点ではカード化は推奨しません。**

## 主な理由

### 1. ドラッグ操作の不安定性は解決しない ❌
- Cardに変更しても、Miroのドラッグイベント処理は同じ
- 座標の取得と更新の仕組みは変わらない
- フレームとの親子関係管理も同じ問題が残る
- デバウンス処理（現在5秒）は引き続き必要

### 2. Rate Limit改善は限定的 △
**現状の問題**:
- 1タスク移動で約200+ credits消費（board.get, getMetadata, setMetadata, sync等）
- 複数タスクの同時移動で100,000 credits/分の制限に到達

**Card化での改善**:
- 基本情報（title, status, dates）のメタデータアクセスが不要に
- **ただし約25-50%の削減にとどまる**（200 creditsから100-150 creditsへ）
- アプリ固有データ（devPlan, roles, externalParticipants等）は引き続きメタデータが必要

### 3. 移行コストが極めて大きい ⚠️
- **全面的なコード書き換え**が必要:
  - `tasksService.ts`: 1223行
  - `calendarLayoutService.ts`: 800+行
  - その他関連ファイル10+
- 既存の全付箋データの変換が必要
- 全機能の再テストと新たなバグ対応
- ユーザーへの影響（既存データの移行）

## メリット・デメリット比較

### Card化のメリット
✅ タスク情報の構造化（title, description, status, dates, assigneeが標準フィールド）
✅ UIの標準化（ステータス表示、期日表示など）
✅ 将来的な拡張性（Miro機能追加の恩恵、サードパーティ連携）

### Card化のデメリット
❌ **根本問題は未解決**（ドラッグの不安定性）
❌ **Rate limit改善は限定的**（25-50%削減、絶対値として不十分）
❌ **移行コストが極大**（1ヶ月以上の開発工数）
❌ 高さの自動計算による制約（現在の時間ベース配置との相性）
❌ カスタマイズ性の低下（付箋のHTML埋め込みの柔軟性が失われる）

## 推奨する代替アプローチ

### 短期的対応（即実施推奨）
1. **現状の付箋実装を維持**
2. **パフォーマンス最適化**:
   - キャッシュ戦略の改善（`taskDateCache`の活用拡大）
   - 不要なメタデータ読み取りの削減
   - フレーム内検索の最適化（既に部分実装済み）
3. **UX改善**:
   - ドラッグ中の視覚的フィードバック追加
   - ローディング状態の表示
   - エラーハンドリングの改善

### 中長期的対応
1. **Miro SDKの進化を監視**:
   - ドラッグ操作APIの改善
   - Cardのカスタマイズ性向上
   - Rate limitポリシーの変更
2. **段階的なリファクタリング**:
   - データモデルをCard互換に近づける設計
   - 将来的な移行を容易にする準備

## 定量的評価

| 項目 | 付箋維持+最適化 | カード化 |
|------|----------------|---------|
| ドラッグ安定性 | 0%改善 | 0%改善 |
| Rate limit | 10-20%改善可能 | 25-50%改善 |
| 実装工数 | 1-2週間 | 1-2ヶ月 |
| リスク | 低 | 高 |
| ユーザー影響 | なし | あり |
| **推奨度** | ⭐⭐⭐⭐ | ⭐⭐ |

## まとめ
現在の付箋実装を維持し、パフォーマンス最適化とUX改善に注力することを推奨します。カード化は、Miro SDKが大幅に改善された時点で再検討が妥当です。

詳細な技術分析は `CARD_MIGRATION_ANALYSIS.md` をご参照ください。

---
調査実施日: 2025-12-12
